{% extends 'attendance/base.html' %}
{% load tz %}

{% block content %}
  <div class="row mb-4">
    <div class="col-md-8">
      <h2>Attendance Report</h2>
    </div>
    <div class="col-md-4 text-end">
      <div class="text-muted">
        <small>
          <strong>Report Generated:</strong><br>
          {% now "F d, Y" %} at {% now "h:i A" %}
        </small>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
          {{ form.start_date.label_tag }}
          {{ form.start_date }}
        </div>
        <div class="col-md-4">
          {{ form.end_date.label_tag }}
          {{ form.end_date }}
        </div>
        <div class="col-md-4">
          <button class="btn btn-primary" type="submit">Filter</button>
          <a class="btn btn-outline-secondary" href="{% url 'attendance:export_attendance' %}?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}{% endif %}">Export CSV</a>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header bg-primary text-white">
      <div class="row">
        <div class="col-md-8">
          <h5 class="mb-0">ðŸ“Š Attendance Summary</h5>
        </div>
        <div class="col-md-4 text-end">
          {% if start_date or end_date %}
            <small>
              {% if start_date and end_date %}
                {{ start_date|date:"M d, Y" }} to {{ end_date|date:"M d, Y" }}
              {% elif start_date %}
                From {{ start_date|date:"M d, Y" }}
              {% elif end_date %}
                Until {{ end_date|date:"M d, Y" }}
              {% endif %}
            </small>
          {% else %}
            <small>All records</small>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      <table class="table table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>Student</th>
            <th>Present</th>
            <th>Late</th>
            <th>Absent</th>
            <th>Total</th>
            <th>Percent</th>
          </tr>
        </thead>
        <tbody>
          {% for row in report %}
            <tr>
              <td>{{ row.student.name }} ({{ row.student.student_id }})</td>
              <td>{{ row.present }}</td>
              <td>{{ row.late }}</td>
              <td>{{ row.absent }}</td>
              <td>{{ row.total }}</td>
              <td>{% if row.pct is not None %}{{ row.pct|floatformat:1 }}%{% else %}-{% endif %}</td>
            </tr>
          {% empty %}
            <tr><td colspan="6" class="text-center">No data</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

{% endblock %}
